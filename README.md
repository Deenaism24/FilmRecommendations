## Общий обзор

В рамках этого проекта были реализованы и обучены две модели рекомендации фильмов для конкретных пользователей: TopPopular и Alternating Least Squares (ALS).

Проект включает данные, исходный код моделей, скрипты для обучения и применения моделей, а также ноутбуки для анализа данных и обучения моделей.

## Используемые библиотеки
```
from abc import ABC, abstractmethod
from typing import List, Dict
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import pickle
from implicit.als import AlternatingLeastSquares
from scipy.sparse import csr_matrix
from sklearn.preprocessing import LabelEncoder
from tqdm.auto import tqdm
```

- `abc `: используется для создания абстрактных классов.
- `typing`: применяется при аннотация типов.
- `numpy`:библиотека для работы с массивами и матрицами чисел. Используется для эффективных численных вычислений.
- `pandas`: основная библиотека для работы с данными в формате таблиц (DataFrame). Используется для чтения CSV-файлов, обработки и агрегации данных.
- `matplotlib`: библиотека для визуализации. Используется в EDA для построения графиков и диаграмм.
- `pickle`: модуль для сериализации и десериализации объектов Python. Используется для сохранения и загрузки обученных моделей.
- `implicit.als.AlternatingLeastSquares`: библиотека для построения рекомендаций на неявных данных. Предоставляет реализацию модели ALS.
- `scipy.sparse.csr_matrix`: модуль для работы с разреженными матрицами. Используется в модели ALS для хранения матрицы связи пользователей и фильмов.
- `sklearn.preprocessing.LabelEncoder`: используется для преобразования категориальных признаков (идентификаторов пользователей и фильмов) в числовые значения для работы с матрицами.
- `tqdm`: библиотека для отображения прогресса выполнения циклов.

## Описание файлов и их функциональности
### 1. Папка `data/`

Содержит следующие файлы с данными:

- `train_data.csv` — данные для обучения, содержащие информацию о просмотрах фильмов пользователями.  
- `test_data.csv` — данные для тестирования, на которых проверяется  модель.  
- `users_df.csv` — описание пользователей, которое может содержать дополнительную информацию о них.  
- `items_df.csv` — описание фильмов, содержащее их характеристики и другие полезные фичи.  
- `countries.csv`, `genres.csv`, `staff.csv` - вспомогательные данные.

### 2. Папка `notebooks/`

- `eda.ipynb` - для анализа выборки обучающих данных.
- `training.ipynb` - для обучения моделей и оценки их качества.

### 3. Директория `src/`

Содержит исходный код моделей и функций для оценки:
- `models.py`: реализует базовые классы и конкретные модели рекомендаций.
- `evaluation.py`: описывает функции для оценки качества рекомендаций.
- `preprocess.py`: описывает функцию для преобработки данных пользователей.

### 4. Директория `saved_models/`

Сохраненные модели после обучения:
- `als_model.pkl`: обученная модель с использованием ALS.
- `toppopular_model.pkl`: обученная модель с использованием TopPopular.
---
#### Функции:

**preprocess_users()**:
    Заполнение пропущенных значений:
   - Заполняет пропущенные значения в столбцах income, sex и education строкой 'unknown'.
   - Заполняет пропущенные значения в столбце kids_flg значением 0.
    Преобразование категориальных признаков в числовые:
   - Для каждого категориального столбца (age_category, income, sex, education):
       * Создается экземпляр LabelEncoder.
       * Значения в столбце преобразуются в числовые метки с помощью le.fit_transform().
       * Обученный энкодер сохраняется в словаре label_encoders (может быть необходим для обратного преобразования меток в категории).
     
### `eda.ipynb`

1. **Загрузка данных**
2. **Анализ данных пользователей**
   *Возрастные категории*
   ![image](https://github.com/user-attachments/assets/466d71a9-8a44-4cef-a770-dbff63840d23)
   На основе выведенной гистограммы можем определить, что большинство пользователей - люди до 45 лет.
   *Уровень дохода*
   ![image](https://github.com/user-attachments/assets/0532603c-2cd9-401f-8e6a-5ed366950bc1)
   Большая часть аудитории получает невысокую зарабатную плату.
3. **Анализ данных о фильмах**
   *Жанры*
   ![image](https://github.com/user-attachments/assets/70d559d9-c1ca-4393-b4fa-52a174572dee)
   Наиболее популярным жанром является драма, а топ-10 завершают документальные картины.
   *Страны*
   ![image](https://github.com/user-attachments/assets/93ae1921-703d-4b24-bd1c-02035261f37a)
   Преобладающее большинство сюжетов выпущено в США и России, количество остальных не превышает 1000.
4. **Анализ данных взаимодейтсвий**
   ![image](https://github.com/user-attachments/assets/fe7ce52d-7d68-4d28-a57c-79902e2e3234)
   График показывает, что почти половина пользователей не смотрели фильмы/сериалы на платформе.
5. **Корреляционный анализ признаков**
   ![image](https://github.com/user-attachments/assets/36eb35eb-9cb6-4a75-bff8-be85f3af2a2a)
   Корреляция признаков указывает на степень линейной зависимости. Степени корреляций близкие к нулю, свидетельствуют о независимости признаков.

### `training.ipynb`

1. **Обучение модели TopPopular**:
   - Создает экземпляр модели `TopPopular`.
   - Обучает модель на данных.
   - Генерирует рекомендации для тестовых пользователей.
   - Оценивает качество рекомендаций с помощью `evaluate_recommender`.
   - Выводит метрики качества.
   * Наилучшие результаты показал параметр зависимости популярности от даты просмотра *time_decay_factor=0.8*. Получились следующие результаты: {'ndcg': 0.20707054581319084, 'recall': 0.11027320797872109}

2. **Обучение модели ALS**:
   - Создает экземпляр модели `ALS` с заданными параметрами.
   - Обучает модель на данных.
   - Генерирует рекомендации для тестовых пользователей.
   - Оценивает качество рекомендаций.
   - Выводит метрики качества.
   * Более высокие метрики оказались при *factors=63, regularization=0.01, iterations=15*: {'ndcg': 0.12649920769480266, 'recall': 0.05910800092819891}

3. **Сохранение моделей**:
   - После обучения и получения метрик, модели сохраняются в папку *saved_models*.
   

## Заключение

Проект представляет собой систему обучения моделей рекомендации фильмов. Две модели: TopPopular и ALS обучаются на одних данных, что позволяет корректно оценить и выбрать подходящую модель для работы. На исходных данных модель TopPopular показала лучшие результаты в сравнении с ALS, хотя рекомендации для всех пользоавтелей совпадали. Это может быть связано с очень высокой долей аудитории, смотрящих одни и те же фильмы или с малым количеством информации о пользователях, поскольку в тестовых данных присутствует мнго пропусков.
